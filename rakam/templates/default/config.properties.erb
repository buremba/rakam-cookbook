store.adapter=presto
presto.address=http://<%= node["opsworks"]["layers"]["presto"]["instances"]["presto-coordinator"]["private_ip"] %>:8080
presto.cold_storage_connector=rakam_raptor
presto.metastore.jdbc.url=jdbc:mysql://<%= node["opsworks"]["stack"]["rds_instances"][0]["address"] %>:<%= node["opsworks"]["stack"]["rds_instances"][0]["port"] %>/<%= node["opsworks"]["stack"]["rds_instances"][0]["db_name"] %>
presto.metastore.jdbc.username=<%= node["opsworks"]["stack"]["rds_instances"][0]["master_username"] %>
presto.metastore.jdbc.password=<%= node["deploy"]["rakam"]["database"]["password"] %>
presto.metastore.jdbc.max_connection=5

<% if defined?(node['rakam-config']['ui-enable']) && node['rakam-config']['ui-enable'] == 'true' -%>
ui.metadata.jdbc.url=jdbc:postgresql://<%= node["deploy"]["rakam"]["database"]["host"] %>:<%= node["deploy"]["rakam"]["database"]["port"] %>/<%= node["deploy"]["rakam"]["database"]["database"] %>
ui.metadata.jdbc.username=<%= node["deploy"]["rakam"]["database"]["username"] %>
ui.metadata.jdbc.password=<%= node["deploy"]["rakam"]["database"]["password"] %>
<% end -%>

event.store=kinesis
event.store.kinesis.stream=<%= node["kinesis"] %>

store.adapter.postgresql.url=jdbc:postgresql://<%= node["deploy"]["rakam"]["database"]["host"] %>:<%= node["deploy"]["rakam"]["database"]["port"] %>/<%= node["deploy"]["rakam"]["database"]["database"] %>
store.adapter.postgresql.username=<%= node["deploy"]["rakam"]["database"]["username"] %>
store.adapter.postgresql.password=<%= node["deploy"]["rakam"]["database"]["password"] %>
store.adapter.postgresql.max_connection=5

plugin.user.enabled=true
plugin.user.mailbox.enable=true
real-time.enabled=true
event.stream.enabled=false
event-explorer.enabled=true
user.funnel-analysis.enabled=true
plugin.user.storage=postgresql
user.retention-analysis.enabled=true
plugin.geoip.enabled=true

http.server.debug=true
http.server.proxy-protocol=true
http.server.address=0.0.0.0:<%= node["rakam-port"] %>
plugin.user.storage.identifier_column=id
plugin.user.mailbox.adapter=postgresql
plugin.user.mailbox.enable=true
module.website.mapper=true
event.ab-testing.enabled=false
module.website.mapper=true
plugin.geoip.connection-type-database.url=https://github.com/maxmind/MaxMind-DB/raw/master/test-data/GeoIP2-Connection-Type-Test.mmdb
plugin.geoip.isp-database.url=https://github.com/maxmind/MaxMind-DB/raw/master/test-data/GeoIP2-ISP-Test.mmdb
automation.enabled=false
plugin.user.actions=email

event.store.bulk.s3-bucket=<%= node["s3"]["bulk"] %>

aws.region=<%= node["opsworks"]["instance"]["region"] %>
presto.streaming.port=5466

log.output-file=rakam-server/logs/app.log
log.enable-console=false

#secret-key=6NRB8NRBZ6QNV6KZ6LUOHLKA9IV1KFHQOWGR35P5BJRYV2UHI937BZVXPGKP
lock-key=<%= node["lock-key"] %>

<% node['rakam-config'].each do |key, value| -%>
<%= key %>=<%= value %>
<% end %>
